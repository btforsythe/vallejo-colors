<!DOCTYPE html>
<html>
<head>
	<title>Proximity Calculator</title>

	<style>
		.colorDisplay {
			padding: 0.35rem 0.7rem;
			border: solid 0.05rem black;
			margin: 0 0.2rem;
		}
	</style>
</head>
<body>
	<label for="rgb">RGB:</label>
	<input type="text" id="rgb" />
	<span class="colorDisplay"></span>
	<label for="setSelector">Set:</label>
	<select id="setSelector"></select>
	<button id="find">Find!</button>

	<script src="./js/color.js"></script>
	<script src="./js/product.js"></script>
	<script src="./js/color-matcher.js"></script>
	<script src="./setsData.js"></script>

	<table>
		<thead>
			<tr>
				<th>Color</th>
				<th colspan="2">Model</th>
				<th>Similarity</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
	<script>
		window.onload = function() {
			populateSetSelector()
			wireColorDisplayUpdate()
			wireFindButton()
		}

		let populateSetSelector = function() {
			let selector = setSelector()
			sets.map(createSetOption).forEach(o => selector.appendChild(o))
		}

		let setSelector = () => document.getElementById('setSelector')

		let createSetOption = function(set) {
			let option = document.createElement('option')
			option.textContent = set.name
			return option
		}

		let wireColorDisplayUpdate = function() {
			rgbInput().onchange = () => {
				let selectedColor = colorToMatch()
				let colorHex = '' + parseInt(selectedColor.red, 16)
				console.log(colorHex)
				colorDisplay().style.backgroundColor =
					`rgb(${selectedColor.blue}, ${selectedColor.green},
					${selectedColor.blue})`
			}
		}

		let rgbInput = () => document.getElementById('rgb')
		let colorDisplay = () => document.querySelector('#rgb + .colorDisplay')

		let colorToMatch = () => Color.fromRgb(rgbInput().value)

		let wireFindButton = function() {
			let find = document.getElementById('find')
			find.onclick = findSetMatches
		}

		let findSetMatches = function() {

			let setColors = selectedSet().products.map(p => p.color)\
			let matches = new ColorMatcher(setColors).match(colorToMatch())

			// clearMatchTableRows()
			matches.forEach(addMatchTableRow)
		}

		// let clearMatchTableRows = 
		let addMatchTableRow = (similarity, color) => {

		}

		let matchesTableBody = document.querySelector(.matches)

		let selectedSet = () => findSetNamed(selectedSetName())
		let findSetNamed = function(name) {
			return sets.find(s => s.name === name)
		}
		let selectedSetName = () => setSelector().selectedOptions[0].value

	</script>
</body>
</html>